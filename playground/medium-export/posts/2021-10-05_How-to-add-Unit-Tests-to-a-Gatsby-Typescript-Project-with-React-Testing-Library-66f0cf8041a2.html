<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>How to add Unit Tests to a Gatsby Typescript Project with React Testing Library</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">How to add Unit Tests to a Gatsby Typescript Project with React Testing Library</h1>
</header>
<section data-field="subtitle" class="p-summary">
Unit tests makes sure that you are writing working code as developers and these tests can guarantee that the individual units are behaving…
</section>
<section data-field="body" class="e-content">
<section name="a635" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="2787" id="2787" class="graf graf--h3 graf--leading graf--title">How to add Unit Tests to a Gatsby Typescript Project with React Testing Library</h3><figure name="3b0a" id="3b0a" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*D02e_lQYKcWbfwlSLr8lcA@2x.png" data-width="4240" data-height="1600" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*D02e_lQYKcWbfwlSLr8lcA@2x.png"></figure><p name="dbe1" id="dbe1" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--figure"><span class="graf-dropCap">U</span>nit tests makes sure that you are writing working code as developers and these tests can guarantee that the individual units are behaving as you expected.</p><p name="1867" id="1867" class="graf graf--p graf-after--p">In this post, I will go through the process of adding Unit tests to a Gatsby TypeScript project with <a href="https://testing-library.com/docs/react-testing-library/intro/" data-href="https://testing-library.com/docs/react-testing-library/intro/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">React Testing Library</a>.</p><h3 name="8a15" id="8a15" class="graf graf--h3 graf-after--p">Pre-requisites</h3><p name="a088" id="a088" class="graf graf--p graf-after--h3">You will need a Gatsby application to try this out. I will be using the <a href="https://github.com/brionmario/gatsby-starter" data-href="https://github.com/brionmario/gatsby-starter" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Gatsby Starter</a> project that I built. Feel free to use the same or you can use this approach on any Gatsby TypeScript project.</p><blockquote name="c266" id="c266" class="graf graf--blockquote graf-after--p">Read the <a href="https://www.gatsbyjs.com/docs/quick-start/" data-href="https://www.gatsbyjs.com/docs/quick-start/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">docs</a> to learn how to create a Gatsby app or explore other TypeScript <a href="https://www.gatsbyjs.com/starters/?" data-href="https://www.gatsbyjs.com/starters/?" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">starters</a>.</blockquote><h3 name="d22e" id="d22e" class="graf graf--h3 graf-after--blockquote">Versions</h3><p name="baf2" id="baf2" class="graf graf--p graf-after--h3">Please note that I’m using the following versions at the time of writing this post.</p><ul class="postList"><li name="7695" id="7695" class="graf graf--li graf-after--p">Gatsby : 3.10.2</li><li name="06b5" id="06b5" class="graf graf--li graf-after--li">Jest: 27.0.6</li><li name="5fed" id="5fed" class="graf graf--li graf-after--li">React Testing Library: 12.0.0</li></ul><blockquote name="3c62" id="3c62" class="graf graf--blockquote graf-after--li">Disclaimer: This procedure is not guaranteed to work if you are using different versions.</blockquote><h3 name="bfde" id="bfde" class="graf graf--h3 graf-after--blockquote">Let’s get started</h3><h4 name="71ac" id="71ac" class="graf graf--h4 graf-after--h3">Install Dependencies</h4><pre name="b7d2" id="b7d2" class="graf graf--pre graf-after--h4">npm install --save-dev jest babel-jest @testing-library/react babel-preset-gatsby identity-obj-proxy</pre><p name="896e" id="896e" class="graf graf--p graf-after--pre">Also since we are on a TypeScript project, we need add type declarations for Jest &amp; Jest DOM.</p><pre name="15d9" id="15d9" class="graf graf--pre graf-after--p">npm install --save-dev @types/jest @testing-library/jest-dom</pre><h4 name="aeee" id="aeee" class="graf graf--h4 graf-after--pre">Configure Jest</h4><p name="e4c8" id="e4c8" class="graf graf--p graf-after--h4">Let’s create a <code class="markup--code markup--p-code">jest.config.js</code> file at the root of the project.</p><pre name="b8b0" id="b8b0" class="graf graf--pre graf-after--p"># From the root of the project<br>touch jest.config.js</pre><figure name="6f8b" id="6f8b" class="graf graf--figure graf--iframe graf-after--pre"><script src="https://gist.github.com/brionmario/cb4d062aa11fe19b0547ceaf84dc541a.js"></script><figcaption class="imageCaption">jets.config.js</figcaption></figure><p name="1d47" id="1d47" class="graf graf--p graf-after--figure">💡 <strong class="markup--strong markup--p-strong">globals</strong></p><p name="8d1d" id="8d1d" class="graf graf--p graf-after--p">Sets <code class="markup--code markup--p-code">__PATH_PREFIX__</code>, which is usually set by Gatsby, and which some components need.</p><p name="6746" id="6746" class="graf graf--p graf-after--p">💡 <strong class="markup--strong markup--p-strong">moduleNameMapper</strong></p><p name="4766" id="4766" class="graf graf--p graf-after--p">Tells Jest how to handle imports. If you can’t test or don’t want to test a particular module you can create mocks.</p><p name="772e" id="772e" class="graf graf--p graf-after--p">For stylesheets, <code class="markup--code markup--p-code">identity-obj-proxy</code> package will be used for mocking. For other assets, you need to use a manual mock called <code class="markup--code markup--p-code">file-mock.js</code> inside a <code class="markup--code markup--p-code">__mocks__ </code>directory in <code class="markup--code markup--p-code">tests</code>.</p><figure name="60ab" id="60ab" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/c477f31ad75508f8533b5b4598d01c9d.js"></script><figcaption class="imageCaption">File Mock (<code class="markup--code markup--figure-code">tests/__mocks__/file-mock.js</code>)</figcaption></figure><p name="c76a" id="c76a" class="graf graf--p graf-after--figure">💡 <strong class="markup--strong markup--p-strong">setupFiles</strong></p><p name="119b" id="119b" class="graf graf--p graf-after--p">Lets you list files that will be included before all tests are run.</p><p name="8fe8" id="8fe8" class="graf graf--p graf-after--p">Create a file called <code class="markup--code markup--p-code">loadershim.js</code> inside the <code class="markup--code markup--p-code">tests</code> directory.</p><figure name="e42c" id="e42c" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/6b5a9f266280d80f0c7727cce1fa96e5.js"></script><figcaption class="imageCaption">loadershim.js (tests/loadershim.js)</figcaption></figure><p name="8c73" id="8c73" class="graf graf--p graf-after--figure">💡 <strong class="markup--strong markup--p-strong">testEnvironment</strong></p><p name="70b6" id="70b6" class="graf graf--p graf-after--p">Test environment that will be used for testing. The default environment in Jest is a Node.js environment.</p><p name="3bf8" id="3bf8" class="graf graf--p graf-after--p">Since our app is a web app, we have to use a browser-like environment through <code class="markup--code markup--p-code">jsdom</code> instead.</p><p name="a215" id="a215" class="graf graf--p graf-after--p">💡 <strong class="markup--strong markup--p-strong">testMatch</strong></p><p name="7d73" id="7d73" class="graf graf--p graf-after--p">The glob patterns Jest uses to detect test files.</p><p name="ee1c" id="ee1c" class="graf graf--p graf-after--p">I have <strong class="markup--strong markup--p-strong">E2E</strong> configured in the project in <code class="markup--code markup--p-code">&lt;root&gt;/cypress</code> directory. The E2E test files uses <code class="markup--code markup--p-code">.spec</code> prefix. If I don’t define <code class="markup--code markup--p-code">testMatch</code> property, Jest tries to run those files as well. Hence, I will ask Jest to only look inside the <code class="markup--code markup--p-code">src</code> directory for any files with the <code class="markup--code markup--p-code">.test</code> prefix inside <code class="markup--code markup--p-code">__tests__</code> directories.</p><p name="6677" id="6677" class="graf graf--p graf-after--p">💡 <strong class="markup--strong markup--p-strong">testPathIgnorePatterns</strong></p><p name="31e9" id="31e9" class="graf graf--p graf-after--p">Jest will ignore any tests in the <code class="markup--code markup--p-code">node_modules</code> ,<code class="markup--code markup--p-code">.cache</code> or <code class="markup--code markup--p-code">public</code> directories.</p><p name="27f8" id="27f8" class="graf graf--p graf-after--p">💡 <strong class="markup--strong markup--p-strong">testURL</strong></p><p name="e0be" id="e0be" class="graf graf--p graf-after--p">Need to specify a proper URL here because some DOM APIs such as localStorage are unhappy with the default (<code class="markup--code markup--p-code">about:blank </code>).</p><p name="68a6" id="68a6" class="graf graf--p graf-after--p">💡 <strong class="markup--strong markup--p-strong">transform</strong></p><p name="3cc3" id="3cc3" class="graf graf--p graf-after--p">Jest that all <code class="markup--code markup--p-code">js</code>, <code class="markup--code markup--p-code">jsx</code>, <code class="markup--code markup--p-code">ts</code> or <code class="markup--code markup--p-code">tsx</code> files need to be transformed using a <code class="markup--code markup--p-code">jest-preprocess.js</code> file in the project root. Let’s create this file inside the <strong class="markup--strong markup--p-strong">tests</strong> folder.</p><figure name="67a0" id="67a0" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/c01231eb2a7f1c327de2430afe4bcc7c.js"></script><figcaption class="imageCaption">jest-preprocess.js (test/jest-preprocess.js)</figcaption></figure><p name="7254" id="7254" class="graf graf--p graf-after--figure">💡 <strong class="markup--strong markup--p-strong">transformIgnorePatterns</strong></p><p name="77ef" id="77ef" class="graf graf--p graf-after--p">Gatsby includes un-transpiled ES6 code. By default Jest doesn’t try to transform code inside <code class="markup--code markup--p-code">node_modules</code> . We need tell Jest to transpile <code class="markup--code markup--p-code">Gatsby</code> only.</p><h4 name="fb09" id="fb09" class="graf graf--h4 graf-after--p">Add useful mocks</h4><p name="5ae6" id="5ae6" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Mocking </strong><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">gatsby</strong></code></p><p name="598d" id="598d" class="graf graf--p graf-after--p">The <a href="https://www.gatsbyjs.com/docs/how-to/testing/unit-testing/#3-useful-mocks-to-complete-your-testing-environment" data-href="https://www.gatsbyjs.com/docs/how-to/testing/unit-testing/#3-useful-mocks-to-complete-your-testing-environment" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">docs</a> suggest to mock <code class="markup--code markup--p-code">gatsby</code> module. This is supposed to be helpful if we want to test features like <code class="markup--code markup--p-code">Link</code> or <code class="markup--code markup--p-code">GraphQL</code> .</p><p name="7e49" id="7e49" class="graf graf--p graf-after--p">Create a <code class="markup--code markup--p-code">gatsby.js</code> file inside the <code class="markup--code markup--p-code">__mocks__ </code>directory in <code class="markup--code markup--p-code">tests</code>.</p><figure name="7b56" id="7b56" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/83f63b5da99d88ae79b587f191db8262.js"></script><figcaption class="imageCaption">Gatsby Mock (tests/__mocks__/gatsby.js)</figcaption></figure><p name="cffd" id="cffd" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Add helper npm scripts</strong></p><p name="3827" id="3827" class="graf graf--p graf-after--p">Let’s add the below helper scripts in the <strong class="markup--strong markup--p-strong">script</strong> section in <code class="markup--code markup--p-code">package.json</code>so that we can easily run our tests.</p><figure name="1350" id="1350" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/be46355c53f2ffbbbf54fad634a7c369.js"></script><figcaption class="imageCaption">Test Scripts</figcaption></figure><h3 name="9cee" id="9cee" class="graf graf--h3 graf-after--figure">Add the first Test</h3><p name="7e2d" id="7e2d" class="graf graf--p graf-after--h3">I will be adding some basic tests to the <strong class="markup--strong markup--p-strong">Copyright </strong>component in my application.</p><p name="7546" id="7546" class="graf graf--p graf-after--p">The copyright component resides in <code class="markup--code markup--p-code">src/components/footer/copyright.tsx</code> . So I’m going to create a new test file in <code class="markup--code markup--p-code">src/components/__tests__/footer/copyright.test.tsx</code> .</p><p name="e6b9" id="e6b9" class="graf graf--p graf-after--p">For demo purpose, I will do a simple <a href="https://jestjs.io/docs/snapshot-testing" data-href="https://jestjs.io/docs/snapshot-testing" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">snapshot test</a> and will check if the component render without any issues.</p><figure name="6195" id="6195" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/9c525939e63e3fabf24ddf9f5a9f4b5c.js"></script><figcaption class="imageCaption">Basic Unit Tests for Copyright Compnent</figcaption></figure><h3 name="fcc6" id="fcc6" class="graf graf--h3 graf-after--figure">Run Tests</h3><p name="953e" id="953e" class="graf graf--p graf-after--h3">You can execute the following command to run the Unit test suite.</p><pre name="2776" id="2776" class="graf graf--pre graf-after--p">npm run test:unit</pre><p name="15b2" id="15b2" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Run with Coverage</strong></p><p name="4aa3" id="4aa3" class="graf graf--p graf-after--p">Execute the following command to run the test coverage.</p><pre name="58ab" id="58ab" class="graf graf--pre graf-after--p">npm run test:unit:coverage</pre><figure name="4118" id="4118" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*kp1adyTmpP0voiL26uSLMA.png" data-width="2235" data-height="1336" src="https://cdn-images-1.medium.com/max/800/1*kp1adyTmpP0voiL26uSLMA.png"><figcaption class="imageCaption">Test with Coverage</figcaption></figure><p name="0ac3" id="0ac3" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Run in watch mode</strong></p><p name="3ac5" id="3ac5" class="graf graf--p graf-after--p">This script will watch files for changes and rerun tests related to changed files. If you want to re-run all tests when a file has changed.</p><pre name="7328" id="7328" class="graf graf--pre graf-after--p">npm run test:unit:watch</pre><h3 name="ba92" id="ba92" class="graf graf--h3 graf-after--pre">Conclusion</h3><p name="a47a" id="a47a" class="graf graf--p graf-after--h3">Hope you found this blog post useful. Feel free to try this out and if you have any suggestions regarding the blog you can log an issue in <a href="https://github.com/brionmario/blog-resources/issues" data-href="https://github.com/brionmario/blog-resources/issues" class="markup--anchor markup--p-anchor" rel="noopener nofollow noopener noopener noopener" target="_blank">this repo</a>.</p><h4 name="e25f" id="e25f" class="graf graf--h4 graf-after--p">Links</h4><ul class="postList"><li name="ed10" id="ed10" class="graf graf--li graf-after--h4"><a href="https://github.com/brionmario/gatsby-starter/tree/init-unit-testing" data-href="https://github.com/brionmario/gatsby-starter/tree/init-unit-testing" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Source Code</a></li></ul><p name="97c7" id="97c7" class="graf graf--p graf-after--li graf--trailing">Signing off… ✌️❤️</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@brionmario" class="p-author h-card">Brion Mario</a> on <a href="https://medium.com/p/66f0cf8041a2"><time class="dt-published" datetime="2021-10-05T09:16:52.566Z">October 5, 2021</time></a>.</p><p><a href="https://medium.com/@brionmario/how-to-add-unit-tests-to-a-gatsby-typescript-project-with-react-testing-library-66f0cf8041a2" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 5, 2023.</p></footer></article></body></html>