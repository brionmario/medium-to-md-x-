<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>How to deploy WSO2 Identity Server My Account on an external server.</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">How to deploy WSO2 Identity Server My Account on an external server.</h1>
</header>
<section data-field="subtitle" class="p-summary">
My Account (previously known as User Portal in Identity Server 5.10.0) is the end-user dashboard of the WSO2 Identity Server(WSO2 IS). With…
</section>
<section data-field="body" class="e-content">
<section name="9d0c" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4ffb" id="4ffb" class="graf graf--h3 graf--leading graf--title">How to deploy WSO2 Identity Server My Account on an external server.</h3><figure name="234d" id="234d" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*vR9zGGWPCS8NSpck2Gl2DA.png" data-width="1380" data-height="440" src="https://cdn-images-1.medium.com/max/800/1*vR9zGGWPCS8NSpck2Gl2DA.png"></figure><p name="8877" id="8877" class="graf graf--p graf-after--figure"><a href="https://is.docs.wso2.com/en/latest/learn/my-account/" data-href="https://is.docs.wso2.com/en/latest/learn/my-account/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">My Account</a> (previously known as <a href="https://is.docs.wso2.com/en/5.10.0/learn/user-portal/" data-href="https://is.docs.wso2.com/en/5.10.0/learn/user-portal/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">User Portal</a> in Identity Server 5.10.0) is the end-user dashboard of the WSO2 Identity Server(WSO2 IS). With the My Account application, users can manage their account-related preferences with more convenience.</p><p name="7c44" id="7c44" class="graf graf--p graf-after--p">It can be accessed via the URL <a href="https://localhost:9443/myaccount" data-href="https://localhost:9443/myaccount" class="markup--anchor markup--p-anchor" target="_blank">https://localhost:9443/myaccount</a> on an Identity Server running with default configurations.</p><h3 name="53a1" id="53a1" class="graf graf--h3 graf-after--p">The Problem</h3><p name="6e81" id="6e81" class="graf graf--p graf-after--h3">If your business requires you to host this application on a server outside of the Identity Server, you’ll be faced with some difficulties.</p><p name="86dc" id="86dc" class="graf graf--p graf-after--p">We pack a <a href="https://docs.oracle.com/javaee/5/tutorial/doc/bnagy.html" data-href="https://docs.oracle.com/javaee/5/tutorial/doc/bnagy.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">JSP</a> index file by default in the artifact. So, if you try to host the artifact found under the path <code class="markup--code markup--p-code">&lt;IS_HOME&gt;/repository/deployment/server/webapps/myaccount</code> , it’ll be impossible out of the box.</p><p name="a4b1" id="a4b1" class="graf graf--p graf-after--p">Even if you try to host the application on an external <a href="http://tomcat.apache.org/" data-href="http://tomcat.apache.org/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Tomcat</a> server, even though JSP is supported, you’ll see an exception like below.</p><figure name="8e6b" id="8e6b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lXoukPHUjXLbUeFkO73CnQ.png" data-width="3838" data-height="2182" src="https://cdn-images-1.medium.com/max/800/1*lXoukPHUjXLbUeFkO73CnQ.png"></figure><p name="791b" id="791b" class="graf graf--p graf-after--figure">The reason for the above exceptions is the usage of some Java utils in the applications to resolve server origin, super tenant information, etc. These utils are extremely helpful to maintain the dynamic nature of the application when it is hosted inside the IS, but when it comes to external deployments, this poses an obstacle.</p><h3 name="1b51" id="1b51" class="graf graf--h3 graf-after--p">Possible Solutions</h3><p name="498b" id="498b" class="graf graf--p graf-after--h3">You can of cause manually remove all the Java dependencies from the index file and try to overcome the issue (only works if you are hosting the application on a Java EE server) or you could check out the source code and build the application so that it is compatible to be hosted on any server.</p><p name="7c5d" id="7c5d" class="graf graf--p graf-after--p">I <strong class="markup--strong markup--p-strong">recommend</strong> the latter option and will explain the process of building a compatible artifact.Prerequisites</p><h4 name="d41d" id="d41d" class="graf graf--h4 graf-after--p">Download and Install an Identity Server Instance</h4><p name="6031" id="6031" class="graf graf--p graf-after--h4">In order to follow along, you’ll need an Identity Server instance running in your local environment. If you don’t have one, please download and install the latest version from the <a href="https://wso2.com/identity-server/" data-href="https://wso2.com/identity-server/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">official website</a>.</p><p name="a50c" id="a50c" class="graf graf--p graf-after--p">At the time of writing this post, Identity Server 5.12.0 is yet to be released and is still in the Alpha phase. I will be the version <a href="https://github.com/wso2/product-is/releases/tag/v5.12.0-alpha4" data-href="https://github.com/wso2/product-is/releases/tag/v5.12.0-alpha4" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">5.12.0-alpha4</a>.</p><h4 name="7108" id="7108" class="graf graf--h4 graf-after--p">Make My Account Configurations Editable in Console</h4><p name="ac13" id="ac13" class="graf graf--p graf-after--h4">Since we are overriding the default behavior of the My Account application, we need to do some modifications to the application’s configurations from the <a href="https://wso2.com/blogs/thesource/whats-new-with-wso2-identity-server-5.11/" data-href="https://wso2.com/blogs/thesource/whats-new-with-wso2-identity-server-5.11/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Console</a>.</p><p name="486e" id="486e" class="graf graf--p graf-after--p">By default, My Account is marked as a read-only application on the Console to avoid unintended misconfigurations but we can override this behavior via the <code class="markup--code markup--p-code">deployment.toml</code> .</p><p name="fa11" id="fa11" class="graf graf--p graf-after--p">Open up <code class="markup--code markup--p-code">deployment.toml</code> file located at <code class="markup--code markup--p-code">&lt;IS_HOME&gt;/repository/conf/deployment.toml</code> and add the following configuration. Restart the server once you’re done.</p><figure name="e293" id="e293" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/brionmario/d270a33887cdcf71bb9ef6cfc1084a88.js"></script></figure><h3 name="5a83" id="5a83" class="graf graf--h3 graf-after--figure">Set-up the Codebase</h3><p name="0484" id="0484" class="graf graf--p graf-after--h3">First, we need to check out the <code class="markup--code markup--p-code"><a href="https://github.com/wso2/identity-apps" data-href="https://github.com/wso2/identity-apps" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener noopener" target="_blank">identity apps</a></code> source code in order to set up the development environment. Make sure you follow the README and set up the <a href="https://github.com/wso2/identity-apps/tree/v1.2.574#setup-build-environment" data-href="https://github.com/wso2/identity-apps/tree/v1.2.574#setup-build-environment" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">required tools</a>.</p><p name="2099" id="2099" class="graf graf--p graf-after--p">It’s recommended to fork the original repository and checkout to your own copy so you could persist any changes that you do.</p><p name="91ef" id="91ef" class="graf graf--p graf-after--p">I’m going to fork my clone.</p><pre name="5a8d" id="5a8d" class="graf graf--pre graf-after--p">$ git clone <a href="https://github.com/brionmario/identity-apps.git" data-href="https://github.com/brionmario/identity-apps.git" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">https://github.com/brionmario/identity-apps.git</a></pre><p name="360a" id="360a" class="graf graf--p graf-after--pre">And then, I’m setting up a new remote for the original repository called <code class="markup--code markup--p-code">upstream</code> .</p><pre name="d414" id="d414" class="graf graf--pre graf-after--p">$ git remote add upstream <a href="https://github.com/wso2/identity-apps.git" data-href="https://github.com/wso2/identity-apps.git" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">https://github.com/wso2/identity-apps.git</a></pre><p name="07e3" id="07e3" class="graf graf--p graf-after--pre">At the time of writing this post, the latest tag of <code class="markup--code markup--p-code">identity-apps</code> is <a href="https://github.com/wso2/identity-apps/releases/tag/v1.2.574" data-href="https://github.com/wso2/identity-apps/releases/tag/v1.2.574" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">v1.2.574</a>. I will be using that in the demonstration.</p><p name="65ec" id="65ec" class="graf graf--p graf-after--p">Execute the following command to fetch all the tags and checkout to a new branch based on the tag we require (v1.2.574).</p><pre name="5d60" id="5d60" class="graf graf--pre graf-after--p">$ git fetch --all --tags --prune</pre><pre name="d2a0" id="d2a0" class="graf graf--pre graf-after--pre">$ git checkout tags/v1.2.574 -b external-deploy</pre><h3 name="63ca" id="63ca" class="graf graf--h3 graf-after--pre">Build the Project</h3><p name="7edf" id="7edf" class="graf graf--p graf-after--h3">Now that we have checked out the code base, let’s install the dependencies and build the entire project.</p><p name="8e34" id="8e34" class="graf graf--p graf-after--p">From the root of the project, execute the following commands.</p><pre name="980e" id="980e" class="graf graf--pre graf-after--p"># Installs all the dependencies and Bootstrap the project<br>$ npm run bootstrap</pre><pre name="0f6c" id="0f6c" class="graf graf--pre graf-after--pre"># Build all the modules and apps.<br>$ npm run build</pre><h3 name="25a2" id="25a2" class="graf graf--h3 graf-after--pre">Deployment</h3><h4 name="9d73" id="9d73" class="graf graf--h4 graf-after--h3">Deploy on an external Java EE Server</h4><p name="7e92" id="7e92" class="graf graf--p graf-after--h4">Perform the following steps in order to build the application without any Java util dependencies.</p><ol class="postList"><li name="dcca" id="dcca" class="graf graf--li graf-after--p">Navigate to the My Account source.</li></ol><pre name="e19c" id="e19c" class="graf graf--pre graf-after--li">$ cd apps/myaccount</pre><p name="63b3" id="63b3" class="graf graf--p graf-after--pre">2. Build the app with either command.</p><pre name="68da" id="68da" class="graf graf--pre graf-after--p">$ npm run build:external</pre><pre name="ef90" id="ef90" class="graf graf--pre graf-after--pre"># Alternative command<br>$ npm run build:prod -- --env IS_DEPLOYED_ON_EXTERNAL_SERVER=true</pre><p name="c185" id="c185" class="graf graf--p graf-after--pre">3. Grab the build artifacts from <code class="markup--code markup--p-code">build/myaccount</code> folder and deploy them on your server.</p><p name="3ed5" id="3ed5" class="graf graf--p graf-after--p">I’m using a Tomcat server so I’ll be copying the artifacts to <code class="markup--code markup--p-code">&lt;TOMCAT_HOME&gt;/webapps</code> .</p><p name="394b" id="394b" class="graf graf--p graf-after--p">4. Configure Authorized Redirect URLs &amp; Allowed Origins</p><p name="25c2" id="25c2" class="graf graf--p graf-after--p">If you try to access the application now (in my case via <a href="http://localhost:8080/myaccount/" data-href="http://localhost:8080/myaccount/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">http://localhost:8080/myaccount</a>), you’ll get an error like below.</p><figure name="a8f5" id="a8f5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DURBP4z6gVkKuhhUbSf3xw.png" data-width="3830" data-height="2302" src="https://cdn-images-1.medium.com/max/800/1*DURBP4z6gVkKuhhUbSf3xw.png"><figcaption class="imageCaption">Invalid Callback Error</figcaption></figure><p name="f506" id="f506" class="graf graf--p graf-after--figure">The reason for this is that the Authorized Redirect URLs configured in the Application configurations do not have an entry for <code class="markup--code markup--p-code">http://localhost:8080/myaccount/login</code> .</p><p name="f20a" id="f20a" class="graf graf--p graf-after--p">Navigate to the Console application via <a href="https://localhost:9443/console" data-href="https://localhost:9443/console" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">https://localhost:9443/console</a> and Go to the <strong class="markup--strong markup--p-strong">Applications </strong>section under <strong class="markup--strong markup--p-strong">Develop</strong>.</p><p name="9318" id="9318" class="graf graf--p graf-after--p">Locate the <strong class="markup--strong markup--p-strong">My Account </strong>application and go to its settings.</p><p name="7cc8" id="7cc8" class="graf graf--p graf-after--p">Under <code class="markup--code markup--p-code">protocol</code> tab, add <code class="markup--code markup--p-code">http://localhost:8080/myaccount/login</code> as an <code class="markup--code markup--p-code">Authorized Redirect URL</code>.</p><p name="47f6" id="47f6" class="graf graf--p graf-after--p">Also, add <code class="markup--code markup--p-code">http://localhost:8080</code> as an <code class="markup--code markup--p-code">Allowed origin</code> to allow cross-origin requests.</p><figure name="4184" id="4184" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*B2tPKoNbLW-VJImH4PuJhg.png" data-width="1662" data-height="924" src="https://cdn-images-1.medium.com/max/800/1*B2tPKoNbLW-VJImH4PuJhg.png"><figcaption class="imageCaption">Configure Allowed Redirect URLs and CORS Origins</figcaption></figure><p name="3249" id="3249" class="graf graf--p graf-after--figure">Now I can see the following when I access <code class="markup--code markup--p-code"><a href="http://localhost:8080/myaccount/" data-href="http://localhost:8080/myaccount/" class="markup--anchor markup--p-anchor" target="_blank">http://localhost:8080/myaccount/</a></code></p><figure name="c191" id="c191" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*TtVxNYVLKgdowCZJLQ5LTg.png" data-width="3834" data-height="2306" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*TtVxNYVLKgdowCZJLQ5LTg.png"><figcaption class="imageCaption">My Account on Tomcat</figcaption></figure><p name="a679" id="a679" class="graf graf--p graf-after--figure">Success! 🎉</p><h4 name="0ed6" id="0ed6" class="graf graf--h4 graf-after--p">Deploy on a static server on the root context</h4><p name="3cf5" id="3cf5" class="graf graf--p graf-after--h4">Perform the following steps in order to build the application with an <code class="markup--code markup--p-code">index.html</code> on the root context without and JSP files or Java EE server-specific folders etc.</p><ol class="postList"><li name="ca52" id="ca52" class="graf graf--li graf-after--p">Navigate to the My Account source.</li></ol><pre name="b621" id="b621" class="graf graf--pre graf-after--li">$ cd apps/myaccount</pre><p name="0a10" id="0a10" class="graf graf--p graf-after--pre">2. Modify the <code class="markup--code markup--p-code">appBaseName</code> to <code class="markup--code markup--p-code">“”</code> (Empty quotes) in <code class="markup--code markup--p-code">public/deployment.config.json</code>.</p><figure name="54b1" id="54b1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*IYeX-VhoFiuKpTLcw-HZ8g.png" data-width="990" data-height="400" src="https://cdn-images-1.medium.com/max/800/1*IYeX-VhoFiuKpTLcw-HZ8g.png"><figcaption class="imageCaption">App Base Name Configuraration</figcaption></figure><blockquote name="f56d" id="f56d" class="graf graf--blockquote graf-after--figure">By default, this is set to <code class="markup--code markup--blockquote-code">myaccount</code> and it will be used by webpack as a base path for constructing static resource paths in the index files.</blockquote><p name="8a7a" id="8a7a" class="graf graf--p graf-after--blockquote">3. Build the app with either command.</p><pre name="508e" id="508e" class="graf graf--pre graf-after--p">$ npm run build:external:static</pre><pre name="752a" id="752a" class="graf graf--pre graf-after--pre"># Alternative command<br>$ npm run build:prod -- --env IS_DEPLOYED_ON_EXTERNAL_SERVER=true --env SERVER_TYPE=static</pre><p name="b18b" id="b18b" class="graf graf--p graf-after--pre">4. Make sure the paths in <code class="markup--code markup--p-code">index.html</code> are as follows.</p><blockquote name="3f90" id="3f90" class="graf graf--blockquote graf-after--p"><code class="markup--code markup--blockquote-code">contextPathGlobal</code> should be empty and all the static asset paths should begin with a <code class="markup--code markup--blockquote-code">/</code> (forward slash).</blockquote><figure name="b5f5" id="b5f5" class="graf graf--figure graf--iframe graf-after--blockquote"><script src="https://gist.github.com/brionmario/1907a07782c45cd0b62f2f8f8d23fa4d.js"></script><figcaption class="imageCaption">index.html</figcaption></figure><p name="84eb" id="84eb" class="graf graf--p graf-after--figure">5. Grab the build artifacts from <code class="markup--code markup--p-code">build/myaccount</code> folder and deploy them on your server.</p><p name="1196" id="1196" class="graf graf--p graf-after--p">6. Configure Authorized Redirect URLs &amp; Allowed Origins</p><p name="4e72" id="4e72" class="graf graf--p graf-after--p">I’m going to host the artifacts on <a href="https://www.google.com/aclk?sa=l&amp;ai=DChcSEwjRkNSyjaXzAhWJMyoKHVO4DjYYABAAGgJ0bQ&amp;sig=AOD64_2M-ueHqyYsHaQDYBKNRQsW0Vq68w&amp;q&amp;nis=1&amp;adurl&amp;ved=2ahUKEwjM2suyjaXzAhX38HMBHbi5CvsQ0Qx6BAgCEAE" data-href="https://www.google.com/aclk?sa=l&amp;ai=DChcSEwjRkNSyjaXzAhWJMyoKHVO4DjYYABAAGgJ0bQ&amp;sig=AOD64_2M-ueHqyYsHaQDYBKNRQsW0Vq68w&amp;q&amp;nis=1&amp;adurl&amp;ved=2ahUKEwjM2suyjaXzAhX38HMBHbi5CvsQ0Qx6BAgCEAE" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Firebase</a>. Hence, I need to update <code class="markup--code markup--p-code">Authorized Redirect URLs</code> and <code class="markup--code markup--p-code">Allowed Origins</code> as follows. Modify them accordingly with your URLs.</p><figure name="e375" id="e375" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MOfUoA4_Zu-3LYOFASmWkQ.png" data-width="1614" data-height="1012" src="https://cdn-images-1.medium.com/max/800/1*MOfUoA4_Zu-3LYOFASmWkQ.png"><figcaption class="imageCaption">Static Deployment — Configure Allowed Redirect URLs and CORS Origins</figcaption></figure><p name="cd51" id="cd51" class="graf graf--p graf-after--figure">Now I can see the following when I access the firebase site URL.</p><figure name="0d25" id="0d25" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*X9g8IPt7N9X2Lxo2j0Ejqg.png" data-width="3830" data-height="2308" src="https://cdn-images-1.medium.com/max/800/1*X9g8IPt7N9X2Lxo2j0Ejqg.png"><figcaption class="imageCaption">My Account on Firebase</figcaption></figure><p name="720e" id="720e" class="graf graf--p graf-after--figure">Success! 🎉</p><h3 name="c5e5" id="c5e5" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="1914" id="1914" class="graf graf--p graf-after--h3">Hope you found this blog post useful</p><p name="00dc" id="00dc" class="graf graf--p graf-after--p graf--trailing">Signing off… ✌️❤️</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@brionmario" class="p-author h-card">Brion Mario</a> on <a href="https://medium.com/p/e928e35ee817"><time class="dt-published" datetime="2021-09-29T21:24:38.431Z">September 29, 2021</time></a>.</p><p><a href="https://medium.com/@brionmario/how-to-deploy-wso2-identity-server-my-account-on-an-external-server-e928e35ee817" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 5, 2023.</p></footer></article></body></html>